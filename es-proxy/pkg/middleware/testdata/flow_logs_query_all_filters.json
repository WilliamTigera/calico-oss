{
  "bool":{
    "filter":[
      {
        "terms":{
          "action":[
            "allow",
            "deny",
            "unknown"
          ]
        }
      },
      {
        "terms":{
          "source_type":[
            "net",
            "ns",
            "wep",
            "hep"
          ]
        }
      },
      {
        "terms":{
          "dest_type":[
            "net",
            "ns",
            "wep",
            "hep"
          ]
        }
      },
      {
        "nested":{
          "path":"source_labels",
          "query":{
            "bool":{
              "filter":[
                {
                  "terms":{
                    "source_labels.labels":[
                      "key1=test",
                      "key1=test2"
                    ]
                  }
                },
                {
                  "terms":{
                    "source_labels.labels":[
                      "key1=test",
                      "key1=test2",
                      "key2!=test",
                      "key2!=test2"
                    ]
                  }
                }
              ]
            }
          }
        }
      },
      {
        "nested":{
          "path":"dest_labels",
          "query":{
            "bool":{
              "filter":[
                {
                  "terms":{
                    "dest_labels.labels":[
                      "key1=test",
                      "key1=test2"
                    ]
                  }
                },
                {
                  "terms":{
                    "dest_labels.labels":[
                      "key1=test",
                      "key1=test2",
                      "key2!=test",
                      "key2!=test2"
                    ]
                  }
                }
              ]
            }
          }
        }
      },
      {
        "range":{
          "end_time":{
            "include_lower":true,
            "include_upper":false,
            "from":"now-3h",
            "to":"now"
          }
        }
      },
      {
        "bool":{
          "minimum_should_match":"1",
          "should":[
            {
              "term":{
                "source_namespace":"tigera-elasticsearch"
              }
            },
            {
              "term":{
                "dest_namespace":"tigera-elasticsearch"
              }
            }
          ]
        }
      },
      {
        "bool":{
          "minimum_should_match":"1",
          "should":[
            {
              "prefix":{
                "source_name_aggr":"coredns"
              }
            },
            {
              "prefix":{
                "dest_name_aggr":"coredns"
              }
            }
          ]
        }
      }
    ]
  }
}

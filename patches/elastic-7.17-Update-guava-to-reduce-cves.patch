From 969fb926f7b1e05df6731216e8b33cce6a474647 Mon Sep 17 00:00:00 2001
From: rene-dekker <rene@tigera.io>
Date: Fri, 14 Jul 2023 14:49:24 -0700
Subject: [PATCH] update-guava-to-reduce-cves

---
 build-tools-internal/version.properties       |  2 +-
 gradle/verification-metadata.xml              | 25 +++++++++++++++----
 plugins/repository-gcs/build.gradle           |  2 +-
 x-pack/plugin/identity-provider/build.gradle  |  2 +-
 .../plugin/repository-encrypted/build.gradle  |  2 +-
 x-pack/plugin/security/build.gradle           |  2 +-
 x-pack/plugin/watcher/build.gradle            |  2 +-
 x-pack/snapshot-tool/build.gradle             |  2 +-
 8 files changed, 27 insertions(+), 12 deletions(-)

diff --git a/build-tools-internal/version.properties b/build-tools-internal/version.properties
index dde076dd3d3..529a387d429 100644
--- a/build-tools-internal/version.properties
+++ b/build-tools-internal/version.properties
@@ -45,7 +45,7 @@ jmh               = 1.26
 # test dependencies
 # when updating this version, also update :qa:evil-tests
 jimfs = 1.2
-jimfs_guava = 30.1-jre
+jimfs_guava = 32.1.1-jre

 # test framework
 networknt_json_schema_validator = 1.0.48
diff --git a/gradle/verification-metadata.xml b/gradle/verification-metadata.xml
index d61888253f2..7000b0c8200 100644
--- a/gradle/verification-metadata.xml
+++ b/gradle/verification-metadata.xml
@@ -589,6 +589,11 @@
             <sha256 value="721cb91842b46fa056847d104d5225c8b8e1e8b62263b993051e1e5a0137b7ec" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="com.google.errorprone" name="error_prone_annotations" version="2.18.0">
+         <artifact name="error_prone_annotations-2.18.0.jar">
+            <sha256 value="9e6814cb71816988a4fd1b07a993a8f21bb7058d522c162b1de849e19bea54ae" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="com.google.errorprone" name="error_prone_annotations" version="2.2.0">
          <artifact name="error_prone_annotations-2.2.0.jar">
             <sha256 value="6ebd22ca1b9d8ec06d41de8d64e0596981d9607b42035f9ed374f9de271a481a" origin="Generated by Gradle"/>
@@ -664,6 +669,11 @@
             <sha256 value="a42edc9cab792e39fe39bb94f3fca655ed157ff87a8af78e1d6ba5b07c4a00ab" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="com.google.guava" name="guava" version="32.1.1-jre">
+         <artifact name="guava-32.1.1-jre.jar">
+            <sha256 value="91fbba37f1c8b251cf9ea9e7d3a369eb79eb1e6a5df1d4bbf483dd0380740281" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="com.google.guava" name="listenablefuture" version="9999.0-empty-to-avoid-conflict-with-guava">
          <artifact name="listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar">
             <sha256 value="b372a037d4230aa57fbeffdef30fd6123f9c0c2db85d0aced00c91b974f33f99" origin="Generated by Gradle"/>
@@ -984,16 +994,16 @@
             <sha256 value="fbfd0d5f2b2f86758b821daa5e79b5d7c965edd9dc1b2cc80b515df1c6ddc22d" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="com.nimbusds" name="nimbus-jose-jwt" version="9.23">
+         <artifact name="nimbus-jose-jwt-9.23.jar">
+            <sha256 value="33ab8084fdae1d75be1b061b1489d4a12045bd7b50c2e24ff152911e4551ec07" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="com.nimbusds" name="nimbus-jose-jwt" version="9.8.1">
          <artifact name="nimbus-jose-jwt-9.8.1.jar">
             <sha256 value="7664cf8c6f2adadf600287812b32878277beda54912eab9d4c2932cd50cb704a" origin="Generated by Gradle"/>
          </artifact>
       </component>
-       <component group="com.nimbusds" name="nimbus-jose-jwt" version="9.23">
-           <artifact name="nimbus-jose-jwt-9.23.jar">
-               <sha256 value="33ab8084fdae1d75be1b061b1489d4a12045bd7b50c2e24ff152911e4551ec07" origin="Generated by Gradle"/>
-           </artifact>
-       </component>
       <component group="com.nimbusds" name="oauth2-oidc-sdk" version="9.37">
          <artifact name="oauth2-oidc-sdk-9.37.jar">
             <sha256 value="44a04bbed5ae3f6d198aa73ee6b545c476e528ec1a267ef3e9f7033f886dd6fe" origin="Generated by Gradle"/>
@@ -3129,6 +3139,11 @@
             <sha256 value="ff10785ac2a357ec5de9c293cb982a2cbb605c0309ea4cc1cb9b9bc6dbe7f3cb" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="org.checkerframework" name="checker-qual" version="3.33.0">
+         <artifact name="checker-qual-3.33.0.jar">
+            <sha256 value="e316255bbfcd9fe50d165314b85abb2b33cb2a66a93c491db648e498a82c2de1" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="org.checkerframework" name="checker-qual" version="3.5.0">
          <artifact name="checker-qual-3.5.0.jar">
             <sha256 value="729990b3f18a95606fc2573836b6958bcdb44cb52bfbd1b7aa9c339cff35a5a4" origin="Generated by Gradle"/>
diff --git a/plugins/repository-gcs/build.gradle b/plugins/repository-gcs/build.gradle
index fb6fe13661b..7d0e1cab6ac 100644
--- a/plugins/repository-gcs/build.gradle
+++ b/plugins/repository-gcs/build.gradle
@@ -29,7 +29,7 @@ dependencies {
   api 'com.google.cloud:google-cloud-storage:2.13.1'
   api 'com.google.cloud:google-cloud-core:2.8.28'
   api 'com.google.cloud:google-cloud-core-http:2.8.28'
-  runtimeOnly 'com.google.guava:guava:31.1-jre'
+  runtimeOnly 'com.google.guava:guava:32.1-jre'
   runtimeOnly 'com.google.guava:failureaccess:1.0.1'
   api "commons-logging:commons-logging:${versions.commonslogging}"
   api "org.apache.logging.log4j:log4j-1.2-api:${versions.log4j}"
diff --git a/x-pack/plugin/identity-provider/build.gradle b/x-pack/plugin/identity-provider/build.gradle
index d302891aa7c..e15dc4db56a 100644
--- a/x-pack/plugin/identity-provider/build.gradle
+++ b/x-pack/plugin/identity-provider/build.gradle
@@ -43,7 +43,7 @@ dependencies {
   api "org.apache.httpcomponents:httpasyncclient:${versions.httpasyncclient}"
   api "org.apache.httpcomponents:httpcore-nio:${versions.httpcore}"
   api "org.apache.httpcomponents:httpclient-cache:${versions.httpclient}"
-  runtimeOnly 'com.google.guava:guava:19.0'
+  runtimeOnly 'com.google.guava:guava:32.1.1-jre'

   testImplementation "org.elasticsearch:mocksocket:${versions.mocksocket}"
   testImplementation(testArtifact(project(xpackModule('core'))))
diff --git a/x-pack/plugin/repository-encrypted/build.gradle b/x-pack/plugin/repository-encrypted/build.gradle
index 393a369d948..2250820c0d7 100644
--- a/x-pack/plugin/repository-encrypted/build.gradle
+++ b/x-pack/plugin/repository-encrypted/build.gradle
@@ -27,5 +27,5 @@ dependencies {
         exclude group: 'javax.xml.bind', module: 'jaxb-api'
     }
     // for encrypted GCS repository integ tests
-    internalClusterTestRuntimeOnly 'com.google.guava:guava:31.1-jre'
+    internalClusterTestRuntimeOnly 'com.google.guava:guava:32.1.1-jre'
 }
diff --git a/x-pack/plugin/security/build.gradle b/x-pack/plugin/security/build.gradle
index 7f720b2f740..1594af01ebe 100644
--- a/x-pack/plugin/security/build.gradle
+++ b/x-pack/plugin/security/build.gradle
@@ -63,7 +63,7 @@ dependencies {
   api "org.apache.httpcomponents:httpasyncclient:${versions.httpasyncclient}"
   api "org.apache.httpcomponents:httpcore-nio:${versions.httpcore}"
   api "org.apache.httpcomponents:httpclient-cache:${versions.httpclient}"
-  runtimeOnly 'com.google.guava:guava:19.0'
+  runtimeOnly 'com.google.guava:guava:32.1.1-jre'

   // Dependencies for oidc
   api "com.nimbusds:oauth2-oidc-sdk:9.37"
diff --git a/x-pack/plugin/watcher/build.gradle b/x-pack/plugin/watcher/build.gradle
index aa06c77bf38..0e9d7af7a79 100644
--- a/x-pack/plugin/watcher/build.gradle
+++ b/x-pack/plugin/watcher/build.gradle
@@ -34,7 +34,7 @@ dependencies {

   // watcher deps
   api 'com.googlecode.owasp-java-html-sanitizer:owasp-java-html-sanitizer:20211018.2'
-  runtimeOnly 'com.google.guava:guava:30.1-jre' // needed by watcher for the html sanitizer
+  runtimeOnly 'com.google.guava:guava:32.1.1-jre' // needed by watcher for the html sanitizer
   runtimeOnly 'com.google.guava:failureaccess:1.0.1'
   api 'com.sun.mail:jakarta.mail:1.6.4'
   api 'com.sun.activation:jakarta.activation:1.2.1'
diff --git a/x-pack/snapshot-tool/build.gradle b/x-pack/snapshot-tool/build.gradle
index f20fa836ae0..2c1a70dce06 100644
--- a/x-pack/snapshot-tool/build.gradle
+++ b/x-pack/snapshot-tool/build.gradle
@@ -34,7 +34,7 @@ dependencies {
   api 'com.google.cloud:google-cloud-storage:2.13.1'
   api 'com.google.cloud:google-cloud-core:2.8.28'
   api 'com.google.cloud:google-cloud-core-http:2.8.28'
-  runtimeOnly 'com.google.guava:guava:31.1-jre'
+  runtimeOnly 'com.google.guava:guava:32.1.1-jre'
   api 'com.google.guava:failureaccess:1.0.1'
   api "commons-logging:commons-logging:${versions.commonslogging}"
   api "org.apache.logging.log4j:log4j-1.2-api:${versions.log4j}"
--
2.34.1

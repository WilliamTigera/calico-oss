From d96acb19c16f9fb198f7f396d7073cc6e0aebe56 Mon Sep 17 00:00:00 2001
From: rene-dekker <rene@tigera.io>
Date: Thu, 7 Mar 2024 15:33:35 -0800
Subject: [PATCH] Update node and IP package

---
 .ci/Dockerfile                                       |  2 +-
 .node-version                                        |  2 +-
 .nvmrc                                               |  2 +-
 WORKSPACE.bazel                                      | 12 ++++++------
 package.json                                         |  2 +-
 .../kbn-test/src/jest/configs/jest_configs.test.ts   |  3 ++-
 packages/kbn-utils/src/streams/reduce_stream.test.ts |  6 +++---
 .../components/__snapshots__/data_view.test.tsx.snap |  7 +++++++
 .../request_oauth_client_credentials_token.test.ts   |  1 +
 .../lib/send_email_graph_api.test.ts                 |  9 ++++++---
 .../app_plugin/__snapshots__/app.test.tsx.snap       |  3 +++
 yarn.lock                                            | 12 ++++++------
 12 files changed, 38 insertions(+), 23 deletions(-)

diff --git a/.ci/Dockerfile b/.ci/Dockerfile
index 1bc561ba65a..2abc36142fb 100644
--- a/.ci/Dockerfile
+++ b/.ci/Dockerfile
@@ -1,7 +1,7 @@
 # NOTE: This Dockerfile is ONLY used to run certain tasks in CI. It is not used to run Kibana or as a distributable.
 # If you're looking for the Kibana Docker image distributable, please see: src/dev/build/tasks/os_packages/docker_generator/templates/dockerfile.template.ts

-ARG NODE_VERSION=20.10.0
+ARG NODE_VERSION=20.11.1

 FROM node:${NODE_VERSION} AS base

diff --git a/.node-version b/.node-version
index d5a159609d0..2dbbe00e679 100644
--- a/.node-version
+++ b/.node-version
@@ -1 +1 @@
-20.10.0
+20.11.1
diff --git a/.nvmrc b/.nvmrc
index d5a159609d0..2dbbe00e679 100644
--- a/.nvmrc
+++ b/.nvmrc
@@ -1 +1 @@
-20.10.0
+20.11.1
diff --git a/WORKSPACE.bazel b/WORKSPACE.bazel
index fc64d36d005..eb5dbbec74e 100644
--- a/WORKSPACE.bazel
+++ b/WORKSPACE.bazel
@@ -27,13 +27,13 @@ check_rules_nodejs_version(minimum_version_string = "3.8.0")
 # we can update that rule.
 node_repositories(
   node_repositories = {
-    "20.10.0-darwin_amd64": ("node-v20.10.0-darwin-x64.tar.gz", "node-v20.10.0-darwin-x64", "5ff5e8abd3eea6e5f507eb6677554f5b2188eedef654096aa4168a9941e91a32"),
-    "20.10.0-darwin_arm64": ("node-v20.10.0-darwin-arm64.tar.gz", "node-v20.10.0-darwin-arm64", "68b93099451d77aac116cf8fce179cabcf53fec079508dc6b39d3a086fb461a8"),
-    "20.10.0-linux_arm64": ("node-v20.10.0-linux-arm64.tar.xz", "node-v20.10.0-linux-arm64", "a5c22683890d5d244f3afd488ef44e573b5b8287f8911b9a1b061ed3f20a5e6d"),
-    "20.10.0-linux_amd64": ("node-v20.10.0-linux-x64.tar.xz", "node-v20.10.0-linux-x64", "9c0fbc8cc7be9a6543af4b9afb05759c538c0f81015c388d63277b0158507697"),
-    "20.10.0-windows_amd64": ("node-v20.10.0-win-x64.zip", "node-v20.10.0-win-x64", "e5b861814a97e28ae7ac06a34e88fd5e0565b447d270c26e20b5ef60bf0aaaf9"),
+    "20.11.1-darwin_amd64": ("node-v20.11.1-darwin-x64.tar.gz", "node-v20.11.1-darwin-x64", "c52e7fb0709dbe63a4cbe08ac8af3479188692937a7bd8e776e0eedfa33bb848"),
+    "20.11.1-darwin_arm64": ("node-v20.11.1-darwin-arm64.tar.gz", "node-v20.11.1-darwin-arm64", "e0065c61f340e85106a99c4b54746c5cee09d59b08c5712f67f99e92aa44995d"),
+    "20.11.1-linux_arm64": ("node-v20.11.1-linux-arm64.tar.xz", "node-v20.11.1-linux-arm64", "36bac185164aa11940715425da1db2ec46e3354325bda9ee0b98b4a607aa0d8b"),
+    "20.11.1-linux_amd64": ("node-v20.11.1-linux-x64.tar.xz", "node-v20.11.1-linux-x64", "e2c39cb70b9ff79575a02747dd1e89917817cce05da21bef6b94eb9e92442024"),
+    "20.11.1-windows_amd64": ("node-v20.11.1-win-x64.zip", "node-v20.11.1-win-x64", "bc032628d77d206ffa7f133518a6225a9c5d6d9210ead30d67e294ff37044bda"),
   },
-  node_version = "20.10.0",
+  node_version = "20.11.1",
   node_urls = [
     "https://us-central1-elastic-kibana-184716.cloudfunctions.net/kibana-ci-proxy-cache/dist/v{version}/{filename}",
   ],
diff --git a/package.json b/package.json
index dbe8ea753c3..526a418cd91 100644
--- a/package.json
+++ b/package.json
@@ -66,7 +66,7 @@
     "url": "https://github.com/elastic/kibana.git"
   },
   "engines": {
-    "node": "20.10.0",
+    "node": "20.11.1",
     "yarn": "^1.22.19"
   },
   "resolutions": {
diff --git a/packages/kbn-test/src/jest/configs/jest_configs.test.ts b/packages/kbn-test/src/jest/configs/jest_configs.test.ts
index 4d68733f58d..8be3879d0b5 100644
--- a/packages/kbn-test/src/jest/configs/jest_configs.test.ts
+++ b/packages/kbn-test/src/jest/configs/jest_configs.test.ts
@@ -84,7 +84,8 @@ describe('jestConfigs', () => {
       ]);
     });

-    it('throws if test file outside root', async () => {
+    // Unskip after https://github.com/tschaub/mock-fs/issues/384
+    it.skip('throws if test file outside root', async () => {
       fs.writeFileSync('/kbn-test/bad.test.js', '');
       await expect(() => jestConfigs.expected('unit')).rejects.toMatchSnapshot();
     });
diff --git a/packages/kbn-utils/src/streams/reduce_stream.test.ts b/packages/kbn-utils/src/streams/reduce_stream.test.ts
index b2cf92a81be..b43b333ce6e 100644
--- a/packages/kbn-utils/src/streams/reduce_stream.test.ts
+++ b/packages/kbn-utils/src/streams/reduce_stream.test.ts
@@ -23,9 +23,9 @@ describe('reduceStream', () => {
       }, 0),
     ]);
     expect(stub).toHaveBeenCalledTimes(3);
-    expect(stub.mock.calls[0]).toEqual([0, 1, 'utf8']);
-    expect(stub.mock.calls[1]).toEqual([1, 2, 'utf8']);
-    expect(stub.mock.calls[2]).toEqual([2, 3, 'utf8']);
+    expect(stub.mock.calls[0]).toEqual([0, 1]);
+    expect(stub.mock.calls[1]).toEqual([1, 2]);
+    expect(stub.mock.calls[2]).toEqual([2, 3]);
   });

   test('provides the return value of the last iteration of the reducer', async () => {
diff --git a/src/plugins/data/public/utils/table_inspector_view/components/__snapshots__/data_view.test.tsx.snap b/src/plugins/data/public/utils/table_inspector_view/components/__snapshots__/data_view.test.tsx.snap
index 7773f2209bf..c6209b6b219 100644
--- a/src/plugins/data/public/utils/table_inspector_view/components/__snapshots__/data_view.test.tsx.snap
+++ b/src/plugins/data/public/utils/table_inspector_view/components/__snapshots__/data_view.test.tsx.snap
@@ -13,6 +13,7 @@ exports[`Inspector Data View component should render empty state 1`] = `
         "_tables": Object {
           "[object Object]": undefined,
         },
+        Symbol(shapeMode): false,
         Symbol(kCapture): false,
       },
     }
@@ -133,6 +134,7 @@ exports[`Inspector Data View component should render empty state 1`] = `
           "_tables": Object {
             "[object Object]": undefined,
           },
+          Symbol(shapeMode): false,
           Symbol(kCapture): false,
         },
       }
@@ -346,6 +348,7 @@ exports[`Inspector Data View component should render loading state 1`] = `
           "_eventsCount": 0,
           "_maxListeners": undefined,
           "_tables": Object {},
+          Symbol(shapeMode): false,
           Symbol(kCapture): false,
         },
       }
@@ -387,6 +390,7 @@ exports[`Inspector Data View component should render single table without select
             "type": "datatable",
           },
         },
+        Symbol(shapeMode): false,
         Symbol(kCapture): false,
       },
     }
@@ -523,6 +527,7 @@ exports[`Inspector Data View component should render single table without select
               "type": "datatable",
             },
           },
+          Symbol(shapeMode): false,
           Symbol(kCapture): false,
         },
       }
@@ -1650,6 +1655,7 @@ exports[`Inspector Data View component should support multiple datatables 1`] =
             "type": "datatable",
           },
         },
+        Symbol(shapeMode): false,
         Symbol(kCapture): false,
       },
     }
@@ -1803,6 +1809,7 @@ exports[`Inspector Data View component should support multiple datatables 1`] =
               "type": "datatable",
             },
           },
+          Symbol(shapeMode): false,
           Symbol(kCapture): false,
         },
       }
diff --git a/x-pack/plugins/actions/server/builtin_action_types/lib/request_oauth_client_credentials_token.test.ts b/x-pack/plugins/actions/server/builtin_action_types/lib/request_oauth_client_credentials_token.test.ts
index caab1637400..ee32fe7eb88 100644
--- a/x-pack/plugins/actions/server/builtin_action_types/lib/request_oauth_client_credentials_token.test.ts
+++ b/x-pack/plugins/actions/server/builtin_action_types/lib/request_oauth_client_credentials_token.test.ts
@@ -83,6 +83,7 @@ describe('requestOAuthClientCredentialsToken', () => {
             "scheduling": "lifo",
             "sockets": Object {},
             "totalSocketCount": 0,
+            Symbol(shapeMode): false,
             Symbol(kCapture): false,
           },
           "maxContentLength": 1000000,
diff --git a/x-pack/plugins/actions/server/builtin_action_types/lib/send_email_graph_api.test.ts b/x-pack/plugins/actions/server/builtin_action_types/lib/send_email_graph_api.test.ts
index f9284363fab..987c5dca867 100644
--- a/x-pack/plugins/actions/server/builtin_action_types/lib/send_email_graph_api.test.ts
+++ b/x-pack/plugins/actions/server/builtin_action_types/lib/send_email_graph_api.test.ts
@@ -100,6 +100,7 @@ describe('sendEmailGraphApi', () => {
             "scheduling": "lifo",
             "sockets": Object {},
             "totalSocketCount": 0,
+            Symbol(shapeMode): false,
             Symbol(kCapture): false,
           },
           "maxContentLength": 1000000,
@@ -109,7 +110,7 @@ describe('sendEmailGraphApi', () => {
           "validateStatus": [Function],
         },
       ]
-      `);
+    `);
   });

   test('email was sent on behalf of the user "from" mailbox', async () => {
@@ -191,6 +192,7 @@ describe('sendEmailGraphApi', () => {
             "scheduling": "lifo",
             "sockets": Object {},
             "totalSocketCount": 0,
+            Symbol(shapeMode): false,
             Symbol(kCapture): false,
           },
           "maxContentLength": 1000000,
@@ -200,7 +202,7 @@ describe('sendEmailGraphApi', () => {
           "validateStatus": [Function],
         },
       ]
-      `);
+    `);
   });

   test('sendMail request was sent to the custom configured Graph API URL', async () => {
@@ -281,6 +283,7 @@ describe('sendEmailGraphApi', () => {
             "scheduling": "lifo",
             "sockets": Object {},
             "totalSocketCount": 0,
+            Symbol(shapeMode): false,
             Symbol(kCapture): false,
           },
           "maxContentLength": 1000000,
@@ -290,7 +293,7 @@ describe('sendEmailGraphApi', () => {
           "validateStatus": [Function],
         },
       ]
-      `);
+    `);
   });

   test('throw the exception and log the proper error if message was not sent successfuly', async () => {
diff --git a/x-pack/plugins/lens/public/app_plugin/__snapshots__/app.test.tsx.snap b/x-pack/plugins/lens/public/app_plugin/__snapshots__/app.test.tsx.snap
index ca14bc908eb..5ece424e0d2 100644
--- a/x-pack/plugins/lens/public/app_plugin/__snapshots__/app.test.tsx.snap
+++ b/x-pack/plugins/lens/public/app_plugin/__snapshots__/app.test.tsx.snap
@@ -11,6 +11,7 @@ Array [
             "_events": Object {},
             "_eventsCount": 0,
             "_maxListeners": undefined,
+            Symbol(shapeMode): false,
             Symbol(kCapture): false,
           },
           "requests": RequestAdapter {
@@ -18,6 +19,7 @@ Array [
             "_eventsCount": 0,
             "_maxListeners": undefined,
             "requests": Map {},
+            Symbol(shapeMode): false,
             Symbol(kCapture): false,
           },
           "tables": TablesAdapter {
@@ -25,6 +27,7 @@ Array [
             "_eventsCount": 0,
             "_maxListeners": undefined,
             "_tables": Object {},
+            Symbol(shapeMode): false,
             Symbol(kCapture): false,
           },
         },
diff --git a/yarn.lock b/yarn.lock
index 5b646c2089a..5279a829c55 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -16394,14 +16394,14 @@ ip-regex@^4.1.0:
   integrity sha512-B9ZWJxHHOHUhUjCPrMpLD4xEq35bUTClHM1S6CBU5ixQnkZmwipwgc96vAd7AAGM9TGHvJR+Uss+/Ak6UphK+Q==

 ip@^1.1.8:
-  version "1.1.8"
-  resolved "https://registry.yarnpkg.com/ip/-/ip-1.1.8.tgz#ae05948f6b075435ed3307acce04629da8cdbf48"
-  integrity sha512-PuExPYUiu6qMBQb4l06ecm6T6ujzhmh+MeJcW9wa89PoAz5pvd4zPgN5WJV104mb6S2T1AwNIAaB70JNrLQWhg==
+  version "1.1.9"
+  resolved "https://registry.yarnpkg.com/ip/-/ip-1.1.9.tgz#8dfbcc99a754d07f425310b86a99546b1151e396"
+  integrity sha512-cyRxvOEpNHNtchU3Ln9KC/auJgup87llfQpQ+t5ghoC/UhL16SWzbueiCsdTnWmqAWl7LadfuwhlqmtOaqMHdQ==

 ip@^2.0.0:
-  version "2.0.0"
-  resolved "https://registry.yarnpkg.com/ip/-/ip-2.0.0.tgz#4cf4ab182fee2314c75ede1276f8c80b479936da"
-  integrity sha512-WKa+XuLG1A1R0UWhl2+1XQSi+fZWMsYKffMZTTYsiZaUD8k2yDAj5atimTUD2TZkyCkNEeYE5NhFZmupOGtjYQ==
+  version "2.0.1"
+  resolved "https://registry.yarnpkg.com/ip/-/ip-2.0.1.tgz#e8f3595d33a3ea66490204234b77636965307105"
+  integrity sha512-lJUL9imLTNi1ZfXT+DU6rBBdbiKGBuay9B6xGSPVjUeQwaH1RIGqef8RZkUtHioLmSNpPR5M4HVKJGm1j8FWVQ==

 ipaddr.js@1.9.1:
   version "1.9.1"
--
2.34.1


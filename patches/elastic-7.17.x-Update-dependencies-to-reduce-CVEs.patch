From 6c3f7d9a848b7967eef08440bde7b54ef34d48f0 Mon Sep 17 00:00:00 2001
From: Jiawei Huang <jiawei@tigera.io>
Date: Mon, 6 Mar 2023 20:06:04 -0800
Subject: [PATCH] Update dependencies to reduce CVEs

This changeset updates Elasticseach dependencies for v7.17.9 to reduce
CVEs detected. The ML artifacts change in [1] is reverted to v7.17.6
behavior as downloading artifacts from `artifacts-snapshot.elastic.co`
doesn't seem to work well with custom Elasticseach builds from source.

[1] https://github.com/elastic/elasticsearch/pull/89985
---
 build-tools-internal/version.properties |   6 +-
 gradle/verification-metadata.xml        | 110 ++++++++++++++++++++++++
 modules/transport-netty4/build.gradle   |   1 +
 plugins/repository-gcs/build.gradle     |   4 +-
 x-pack/plugin/ml/build.gradle           |  25 +-----
 x-pack/plugin/security/build.gradle     |   6 +-
 x-pack/plugin/vector-tile/build.gradle  |   4 +-
 x-pack/snapshot-tool/build.gradle       |   4 +-
 8 files changed, 127 insertions(+), 33 deletions(-)

diff --git a/build-tools-internal/version.properties b/build-tools-internal/version.properties
index 0491beeee09..21d284bc483 100644
--- a/build-tools-internal/version.properties
+++ b/build-tools-internal/version.properties
@@ -9,7 +9,7 @@ spatial4j         = 0.7
 jts               = 1.15.0
 jackson           = 2.14.2
 snakeyaml         = 1.33
-icu4j             = 62.1
+icu4j             = 68.2
 supercsv          = 2.4.0
 # when updating log4j, please update also docs/java-api/index.asciidoc
 log4j             = 2.17.1
@@ -17,7 +17,7 @@ slf4j             = 1.6.2
 
 jna               = 5.10.0
 
-netty             = 4.1.66.Final
+netty             = 4.1.87.Final
 joda              = 2.10.10
 
 commons_lang3                   = 3.9
@@ -26,7 +26,7 @@ commons_lang3                   = 3.9
 #  - plugins/ingest-attachment (transitive dependency, check the upstream POM)
 #  - distribution/tools/plugin-cli
 #  - x-pack/plugin/security
-bouncycastle=1.64
+bouncycastle=1.70
 # test dependencies
 randomizedrunner  = 2.8.0
 junit             = 4.12
diff --git a/gradle/verification-metadata.xml b/gradle/verification-metadata.xml
index 4ffb23c7b03..62d25687b21 100644
--- a/gradle/verification-metadata.xml
+++ b/gradle/verification-metadata.xml
@@ -784,6 +784,11 @@
             <sha256 value="a204ec68748a7b26351ae37a311e8de468f248d1916d5f8dbe812c1289d0a0ff" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="com.google.protobuf" name="protobuf-java" version="3.21.9">
+         <artifact name="protobuf-java-3.21.9.jar">
+            <sha256 value="1b78b4a76a71512debfdff8f8fc5aef6bfd459f65758fecf7aff245e6e6301e4" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="com.google.protobuf" name="protobuf-java" version="3.4.0">
          <artifact name="protobuf-java-3.4.0.jar">
             <sha256 value="dce7e66b32456a1b1198da0caff3a8acb71548658391e798c79369241e6490a4" origin="Generated by Gradle"/>
@@ -794,6 +799,11 @@
             <sha256 value="bf320ed076000e1d8c7cbf7601b056acaecab80f75b9a659b9f6398d0d7e3f79" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="com.google.protobuf" name="protobuf-java-util" version="3.21.9">
+         <artifact name="protobuf-java-util-3.21.9.jar">
+            <sha256 value="a78226d02551ca2cb34b24b4168a75b4a84041cc3333f3725bb5ad9806a80b77" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="com.google.re2j" name="re2j" version="1.1">
          <artifact name="re2j-1.1.jar">
             <sha256 value="24ada84d1b5de584e3e84b06f0c7dd562cee6eafe8dea8083bd8eb123823bbe7" origin="Generated by Gradle"/>
@@ -839,6 +849,11 @@
             <sha256 value="e5b0962e566003d68bf3ec7d87b60e279f5cc7aa93cbc4056432803046512478" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="com.ibm.icu" name="icu4j" version="68.2">
+         <artifact name="icu4j-68.2.jar">
+            <sha256 value="9bd7bf869a44ba8aeb0cddd7e6616e88cd4795ba5bfce2230447cb0e185a646c" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="com.jamesmurty.utils" name="java-xmlbuilder" version="0.4">
          <artifact name="java-xmlbuilder-0.4.jar">
             <sha256 value="681e53c4ffd59fa12068803b259e3a83d43f07a47c112e748a187dee179eb31f" origin="Generated by Gradle"/>
@@ -1374,6 +1389,11 @@
             <sha256 value="99af46a08546da9e03cb5cd6e3daac624771bb08663f304d60a988e27da59cef" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-buffer" version="4.1.87.Final">
+         <artifact name="netty-buffer-4.1.87.Final.jar">
+            <sha256 value="4e3abdf4ddb8810f5fb4a2b57c9144407873b359faa1894007673ed1465dd3e8" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec" version="4.1.42.Final">
          <artifact name="netty-codec-4.1.42.Final.jar">
             <sha256 value="e96ced697fb7df589da7c20c995e01f75a9cb246be242bbc4cd3b4af424ff189" origin="Generated by Gradle"/>
@@ -1389,6 +1409,11 @@
             <sha256 value="d852eab012b0f06c94a625f96404e32e8fe829708a84e10ae71b2d8dfab47f9e" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec" version="4.1.87.Final">
+         <artifact name="netty-codec-4.1.87.Final.jar">
+            <sha256 value="c643fe8318b7c7405acec13ed98e8f634f917960b20486295efbc5a690bac694" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec-dns" version="4.1.53.Final">
          <artifact name="netty-codec-dns-4.1.53.Final.jar">
             <sha256 value="747098d17592d092afdfd8c746e099c3b739986461ebcfa68d782f4b5b19b8ae" origin="Generated by Gradle"/>
@@ -1399,6 +1424,11 @@
             <sha256 value="971e776bead872081c9f8133ded6835add18b26f627194a79957425563fd614f" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec-dns" version="4.1.87.Final">
+         <artifact name="netty-codec-dns-4.1.87.Final.jar">
+            <sha256 value="c19f96d217e91ddf76a122d4d542566239b64399a2b5f49533ca37acf63ef74f" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec-http" version="4.1.53.Final">
          <artifact name="netty-codec-http-4.1.53.Final.jar">
             <sha256 value="48a81eec058871c4eaf66670f824a76f403579c53ac7a6840dd6ace9dfc4ad4e" origin="Generated by Gradle"/>
@@ -1409,6 +1439,11 @@
             <sha256 value="b30b35c69bfe39497aeaf2c7a99bcaea68a9d3eaeee403ecb597cd14f5df4205" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec-http" version="4.1.87.Final">
+         <artifact name="netty-codec-http-4.1.87.Final.jar">
+            <sha256 value="39368c15595b791dbe26e7639cf2e71b6647bab8838fa5781cf7a80762eac927" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec-http2" version="4.1.53.Final">
          <artifact name="netty-codec-http2-4.1.53.Final.jar">
             <sha256 value="6c777f308be5bb53f33925e695dc97f0b88688e2f1937c2c7a3975e977362df4" origin="Generated by Gradle"/>
@@ -1419,6 +1454,11 @@
             <sha256 value="206e8685fc0e75860b348b2925e6a416d1bace4cea82adbb87abcbc8cb91ad2d" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec-http2" version="4.1.87.Final">
+         <artifact name="netty-codec-http2-4.1.87.Final.jar">
+            <sha256 value="e5d01b8db385b23103de67d3666c6fa9fa144d42217a3c8266b2a5efe425f093" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec-socks" version="4.1.53.Final">
          <artifact name="netty-codec-socks-4.1.53.Final.jar">
             <sha256 value="8de51d13f48da8eece7df43aa00d6d2923a215668526d8888879fa1534e9aafe" origin="Generated by Gradle"/>
@@ -1429,6 +1469,11 @@
             <sha256 value="f81e9c0c9879769fe5fea1fef54405a9efb0562b4b2f144ab8641819ea38d44b" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec-socks" version="4.1.87.Final">
+         <artifact name="netty-codec-socks-4.1.87.Final.jar">
+            <sha256 value="41a76a64514f8f8f50ab8527254073521394138e8a96191905e8c143368b2006" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-common" version="4.1.42.Final">
          <artifact name="netty-common-4.1.42.Final.jar">
             <sha256 value="3d0a918d78292eeca02a7bb2188daa4e5053b6e29b71e6308309033e121242b5" origin="Generated by Gradle"/>
@@ -1444,6 +1489,11 @@
             <sha256 value="bf7e66d832e62dd2cbe7802a3d45ece7f8c6de2958e69d85fae0149cb0820459" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-common" version="4.1.87.Final">
+         <artifact name="netty-common-4.1.87.Final.jar">
+            <sha256 value="811443fc1411a9ef7c1f7b02a750e2a6688f1eec0ae7361ed07812a85d982c86" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-handler" version="4.1.42.Final">
          <artifact name="netty-handler-4.1.42.Final.jar">
             <sha256 value="11eda86500c33b9d386719b5419f513fd9c097d13894f25dd0c75b610d636e03" origin="Generated by Gradle"/>
@@ -1459,6 +1509,11 @@
             <sha256 value="b67da9271458afb434478d86be9f2736a5be2981e49eda2429a9962b10684f7f" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-handler" version="4.1.87.Final">
+         <artifact name="netty-handler-4.1.87.Final.jar">
+            <sha256 value="31a20e1de13b06a677a4719fd5aa95635982114a32c1d034739a48cceada2383" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-handler-proxy" version="4.1.53.Final">
          <artifact name="netty-handler-proxy-4.1.53.Final.jar">
             <sha256 value="1f4b5a540f596e45bcde7c53f4c02780aa5e56eea4103eee78b7d104f90c97b1" origin="Generated by Gradle"/>
@@ -1469,6 +1524,11 @@
             <sha256 value="b300d6276cd7f3c35b16ed5f55ec9d6752ccdebac78473e02d607e1c76792247" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-handler-proxy" version="4.1.87.Final">
+         <artifact name="netty-handler-proxy-4.1.87.Final.jar">
+            <sha256 value="65276b2ab687b1b7c1ceabcc941d6e2cce1038f35b581218d7dbf46b16c5b4ac" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-resolver" version="4.1.42.Final">
          <artifact name="netty-resolver-4.1.42.Final.jar">
             <sha256 value="89768242b6b7cce9bd9f5945ad21d1b4bae515c6b1bf03a8af5d1899779cebc9" origin="Generated by Gradle"/>
@@ -1484,6 +1544,11 @@
             <sha256 value="e89040e9a760f13ec6c05175d633254dd4ea603b204f7a442744485b3c46d1eb" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-resolver" version="4.1.87.Final">
+         <artifact name="netty-resolver-4.1.87.Final.jar">
+            <sha256 value="ee11d22d240b4b125edaed23ec7cc35ad9241b1b8fdd50630de20411ec345fc7" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-resolver-dns" version="4.1.53.Final">
          <artifact name="netty-resolver-dns-4.1.53.Final.jar">
             <sha256 value="bb63961902ce4a4724e80efde16a63b06f871a2cb2387eb90aa2c3663f17db90" origin="Generated by Gradle"/>
@@ -1494,6 +1559,11 @@
             <sha256 value="79a4ebf15abf47e17bcb04dfd6f47ab5c89eff40ea2b28aba60a64168aad08be" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-resolver-dns" version="4.1.87.Final">
+         <artifact name="netty-resolver-dns-4.1.87.Final.jar">
+            <sha256 value="33eaaf06577eb2b56d69dd6c8b82ebb0439c2e3d30c2d46608c90c6748dc0608" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-transport" version="4.1.42.Final">
          <artifact name="netty-transport-4.1.42.Final.jar">
             <sha256 value="dfa817a156ea263aa9ad8364a2e226527665c9722aca40a7945f228c2c14f1da" origin="Generated by Gradle"/>
@@ -1509,6 +1579,11 @@
             <sha256 value="59e0c2f8e55e0c1d5df254226395a865af87a9e11f8b96d2dff92660b1dbcfc1" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-transport" version="4.1.87.Final">
+         <artifact name="netty-transport-4.1.87.Final.jar">
+            <sha256 value="17ed465cf5b1579b72379e47be3ba7fccb09dda8d95d47c8d668118483b08f43" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-transport-native-epoll" version="4.1.42.Final">
          <artifact name="netty-transport-native-epoll-4.1.42.Final.jar">
             <sha256 value="3c7d659b3bd773e0ea9b7517d2d6baffa275a3d2ae8eb4c10cb8f0a7724b11d5" origin="Generated by Gradle"/>
@@ -1534,6 +1609,11 @@
             <sha256 value="aba6624772e2b85cc7bce6a8b734a4cac418d08b7319ec446a328fe54571b4b7" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-transport-native-unix-common" version="4.1.87.Final">
+         <artifact name="netty-transport-native-unix-common-4.1.87.Final.jar">
+            <sha256 value="cc2d013c933c206605da01be39f4c2c1f4586a1b9103a665bd724bdd46d9cd0c" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="io.opencensus" name="opencensus-api" version="0.28.0">
          <artifact name="opencensus-api-0.28.0.jar">
             <sha256 value="0c1723f3f6d3061323845ce8b88b35fdda500812e0a75b8eb5fcc4ad8c871a95" origin="Generated by Gradle"/>
@@ -1797,6 +1877,11 @@
             <sha256 value="0972bbc99437c4163acd09b630e6c77eab4cfab8a9594621c95466c0c6645396" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="net.minidev" name="accessors-smart" version="2.4.8">
+         <artifact name="accessors-smart-2.4.8.jar">
+            <sha256 value="7dd705aa1ac0e030f8ee2624e8e77239ae1eef6ccc2621c0b8c189866ee1c42c" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="net.minidev" name="json-smart" version="2.3">
          <artifact name="json-smart-2.3.jar">
             <sha256 value="903f48c8aa4c3f6426440b8d32de89fa1dc23b1169abde25e4e1d068aa67708b" origin="Generated by Gradle"/>
@@ -1807,6 +1892,11 @@
             <sha256 value="64072f56d9dff5040b2acec477c5d5e6bcebfc88c508f12acb26072d07942146" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="net.minidev" name="json-smart" version="2.4.8">
+         <artifact name="json-smart-2.4.8.jar">
+            <sha256 value="174a9ad578b56644e62b3965d8bf94ac3a76e707c6343b8abac9d3671438b4b2" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="net.sf.ehcache" name="ehcache" version="2.10.4">
          <artifact name="ehcache-2.10.4.jar">
             <sha256 value="32efe00173a887743c614aa625588247fa40edaa56ed8a36ca7d0231cad82468" origin="Generated by Gradle"/>
@@ -2941,6 +3031,11 @@
             <sha256 value="2e2ec8fe0cf873979f630ae4d35e7ede3390321279b7a15de9deed3f3430990c" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="org.apache.santuario" name="xmlsec" version="2.1.8">
+         <artifact name="xmlsec-2.1.8.jar">
+            <sha256 value="75b6f42147bc8e8718a764821439937fee224a8322ac43ff0b2b406edd7f5c2b" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="org.apache.servicemix.bundles" name="org.apache.servicemix.bundles.antlr" version="2.7.7_5">
          <artifact name="org.apache.servicemix.bundles.antlr-2.7.7_5.jar">
             <sha256 value="3902794d36d9b81da1b7e697f21ed04ccae276cc116eecc640a4cd0fff2691f2" origin="Generated by Gradle"/>
@@ -3004,6 +3099,11 @@
             <sha256 value="9b88abe9e981d17113a081a4b4261f4082ccdf9144a8a8373fc460c586f6b13a" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="org.bouncycastle" name="bcmail-jdk15on" version="1.70">
+         <artifact name="bcmail-jdk15on-1.70.jar">
+            <sha256 value="ff6cde372bcabca182e40c1cc5d9b1f9eb73370cad286ce362d3747aff15f230" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="org.bouncycastle" name="bcpg-fips" version="1.0.4">
          <artifact name="bcpg-fips-1.0.4.jar">
             <sha256 value="b73c80be1099c4756c088cb457a82040509b787519af5c72c9c3d1bff357565e" origin="Generated by Gradle"/>
@@ -3024,6 +3124,11 @@
             <sha256 value="84669138b1d99143e2c009024f67824ab8d3edb9b05b7591f5ebfb020a4bda71" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="org.bouncycastle" name="bcpkix-jdk15on" version="1.70">
+         <artifact name="bcpkix-jdk15on-1.70.jar">
+            <sha256 value="e5b9cb821df57f70b0593358e89c0e8d7266515da9d088af6c646f63d433c07c" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="org.bouncycastle" name="bcprov-jdk15on" version="1.60">
          <artifact name="bcprov-jdk15on-1.60.jar">
             <sha256 value="7f1a0e6badab38666f8467a9a0ee96656b2f8ec8623867ed34f3cdc173b7ee07" origin="Generated by Gradle"/>
@@ -3039,6 +3144,11 @@
             <sha256 value="e469bd39f936999f256002631003ff022a22951da9d5bd9789c7abfa9763a292" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="org.bouncycastle" name="bcprov-jdk15on" version="1.70">
+         <artifact name="bcprov-jdk15on-1.70.jar">
+            <sha256 value="8f3c20e3e2d565d26f33e8d4857a37d0d7f8ac39b62a7026496fcab1bdac30d4" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="org.bouncycastle" name="bctls-fips" version="1.0.9">
          <artifact name="bctls-fips-1.0.9.jar">
             <sha256 value="ada8549467dda0017e098f2362bd7f00841244351d1fc6f89b9da5ff25890151" origin="Generated by Gradle"/>
diff --git a/modules/transport-netty4/build.gradle b/modules/transport-netty4/build.gradle
index d54cadb6eb2..ecdc9981049 100644
--- a/modules/transport-netty4/build.gradle
+++ b/modules/transport-netty4/build.gradle
@@ -35,6 +35,7 @@ dependencies {
   api "io.netty:netty-handler:${versions.netty}"
   api "io.netty:netty-resolver:${versions.netty}"
   api "io.netty:netty-transport:${versions.netty}"
+  api "io.netty:netty-transport-native-unix-common:${versions.netty}"
 }
 
 restResources {
diff --git a/plugins/repository-gcs/build.gradle b/plugins/repository-gcs/build.gradle
index bb8065918e1..fb6fe13661b 100644
--- a/plugins/repository-gcs/build.gradle
+++ b/plugins/repository-gcs/build.gradle
@@ -37,8 +37,8 @@ dependencies {
   api 'com.google.api:api-common:2.3.1'
   api 'com.google.api:gax:2.20.1'
   api 'org.threeten:threetenbp:1.6.5'
-  api 'com.google.protobuf:protobuf-java-util:3.17.3'
-  api 'com.google.protobuf:protobuf-java:3.21.7'
+  api 'com.google.protobuf:protobuf-java-util:3.21.9'
+  api 'com.google.protobuf:protobuf-java:3.21.9'
   api 'com.google.code.gson:gson:2.10'
   api 'com.google.api.grpc:proto-google-common-protos:2.9.6'
   api 'com.google.api.grpc:proto-google-iam-v1:1.6.2'
diff --git a/x-pack/plugin/ml/build.gradle b/x-pack/plugin/ml/build.gradle
index c13d178c3b2..736ceb835ad 100644
--- a/x-pack/plugin/ml/build.gradle
+++ b/x-pack/plugin/ml/build.gradle
@@ -1,5 +1,3 @@
-import org.elasticsearch.gradle.VersionProperties
-
 apply plugin: 'elasticsearch.internal-es-plugin'
 apply plugin: 'elasticsearch.internal-cluster-test'
 apply plugin: 'elasticsearch.internal-test-artifact'
@@ -13,8 +11,6 @@ esplugin {
   extendedPlugins = ['x-pack-autoscaling', 'lang-painless']
 }
 
-def localRepo = providers.systemProperty('build.ml_cpp.repo').orNull
-
 if (useDra == false) {
   repositories {
     exclusiveContent {
@@ -24,27 +20,14 @@ if (useDra == false) {
       forRepository {
         ivy {
           name "ml-cpp"
+          url providers.systemProperty('build.ml_cpp.repo').orElse('https://prelert-artifacts.s3.amazonaws.com').get()
           metadataSources {
             // no repository metadata, look directly for the artifact
             artifact()
           }
-          if (localRepo) {
-            url localRepo
-            patternLayout {
-              artifact "maven/[orgPath]/[module]/[revision]/[module]-[revision](-[classifier]).[ext]"
-            }
-          } else {
-            url "https://artifacts-snapshot.elastic.co/"
-            patternLayout {
-              if (VersionProperties.isElasticsearchSnapshot()) {
-                artifact '/ml-cpp/[revision]/downloads/ml-cpp/[module]-[revision](-[classifier]).[ext]'
-              } else {
-                // When building locally we always use snapshot artifacts even if passing `-Dbuild.snapshot=false`.
-                // Release builds are always done with a local repo.
-                artifact '/ml-cpp/[revision]-SNAPSHOT/downloads/ml-cpp/[module]-[revision]-SNAPSHOT(-[classifier]).[ext]'
-              }
-            }
-          }
+          patternLayout {
+            artifact "maven/org/elasticsearch/ml/ml-cpp/[revision]/ml-cpp-[revision].[ext]"
+         }
         }
       }
     }
diff --git a/x-pack/plugin/security/build.gradle b/x-pack/plugin/security/build.gradle
index 5b09033449d..efa7e22c333 100644
--- a/x-pack/plugin/security/build.gradle
+++ b/x-pack/plugin/security/build.gradle
@@ -51,7 +51,7 @@ dependencies {
   api "org.opensaml:opensaml-storage-api:3.4.5"
   api "org.opensaml:opensaml-storage-impl:3.4.5"
   api "net.shibboleth.utilities:java-support:7.5.1"
-  api "org.apache.santuario:xmlsec:2.1.4"
+  api "org.apache.santuario:xmlsec:2.1.8"
   api "io.dropwizard.metrics:metrics-core:3.2.2"
   api ("org.cryptacular:cryptacular:1.2.4") {
     exclude group: 'org.bouncycastle'
@@ -71,8 +71,8 @@ dependencies {
   api "com.nimbusds:lang-tag:1.4.4"
   api "com.sun.mail:jakarta.mail:1.6.3"
   api "net.jcip:jcip-annotations:1.0"
-  api "net.minidev:json-smart:2.4.2"
-  api "net.minidev:accessors-smart:2.4.2"
+  api "net.minidev:json-smart:2.4.8"
+  api "net.minidev:accessors-smart:2.4.8"
   api "org.ow2.asm:asm:9.1"
 
   testImplementation "org.elasticsearch:mocksocket:${versions.mocksocket}"
diff --git a/x-pack/plugin/vector-tile/build.gradle b/x-pack/plugin/vector-tile/build.gradle
index c4833440c24..6fca9f6bee9 100644
--- a/x-pack/plugin/vector-tile/build.gradle
+++ b/x-pack/plugin/vector-tile/build.gradle
@@ -29,11 +29,11 @@ dependencies {
   testImplementation(testArtifact(project(xpackModule('core'))))
   compileOnly "org.locationtech.jts:jts-core:${versions.jts}"
   api "com.wdtinc:mapbox-vector-tile:3.1.0"
-  api "com.google.protobuf:protobuf-java:3.16.3"
+  api "com.google.protobuf:protobuf-java:3.21.9"
   runtimeOnly("org.slf4j:slf4j-api:${versions.slf4j}")
   runtimeOnly("org.apache.logging.log4j:log4j-slf4j-impl:${versions.log4j}")
   javaRestTestImplementation("com.wdtinc:mapbox-vector-tile:3.1.0")
-  javaRestTestImplementation("com.google.protobuf:protobuf-java:3.16.3")
+  javaRestTestImplementation("com.google.protobuf:protobuf-java:3.21.9")
 }
 
 testClusters.configureEach {
diff --git a/x-pack/snapshot-tool/build.gradle b/x-pack/snapshot-tool/build.gradle
index fc62ad87a9e..f20fa836ae0 100644
--- a/x-pack/snapshot-tool/build.gradle
+++ b/x-pack/snapshot-tool/build.gradle
@@ -42,8 +42,8 @@ dependencies {
   api 'com.google.api:api-common:2.3.1'
   api 'com.google.api:gax:2.20.1'
   api 'org.threeten:threetenbp:1.6.5'
-  api 'com.google.protobuf:protobuf-java-util:3.17.3'
-  api 'com.google.protobuf:protobuf-java:3.21.7'
+  api 'com.google.protobuf:protobuf-java-util:3.21.9'
+  api 'com.google.protobuf:protobuf-java:3.21.9'
   api 'com.google.code.gson:gson:2.10'
   api 'com.google.api.grpc:proto-google-common-protos:2.9.6'
   api 'com.google.api.grpc:proto-google-iam-v1:1.6.2'
-- 
2.39.2


---
layout: null
---

# Configuration options for CNX Manager web interface.
# These must be edited before use.
kind: ConfigMap
apiVersion: v1
metadata:
  name: tigera-cnx-manager-web-config
  namespace: kube-system
data:
  # The OIDC client id to use for Google login.
  # Kubelet must be configured accordingly.
  # Only required if using Google login.
  tigera.cnx-web.oidc-client-id: "<fill in client ID here>"
  # The location of the Kubernetes API.
  # This must be reachable from where the web interface
  # will be accessed from.
  tigera.cnx-web.kubernetes-api: "localhost:6443"

---

# Create a NodePort to expose the web application
# This may be edited before use, if you wish to expose
# the web application differently.
# If using Google login, the URL for the web application
# must be configured as a redirect URI in the Google
# project.
apiVersion: v1
kind: Service
metadata:
  labels:
    k8s-app: tigera-cnx-manager-web
  name: tigera-cnx-manager-web
  namespace: kube-system
spec:
  selector:
    k8s-app: tigera-cnx-manager-web
  ports:
    - port: 8080
      targetPort: 80
      # The NodePort to reach the web application on.
      nodePort: 30003
  type: NodePort

---

apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: tigera-cnx-manager-web
  namespace: kube-system
  labels:
    k8s-app: tigera-cnx-manager-web
spec:
  replicas: 1
  strategy:
    type: Recreate
  template:
    metadata:
      name: tigera-cnx-manager-web
      namespace: kube-system
      labels:
        k8s-app: tigera-cnx-manager-web
      annotations:
        # Mark this pod as a critical add-on; when enabled, the critical add-on scheduler
        # reserves resources for critical add-on pods so that they can be rescheduled after
        # a failure.  This annotation works in tandem with the toleration below.
        scheduler.alpha.kubernetes.io/critical-pod: ''
    spec:
      tolerations:
      - key: node-role.kubernetes.io/master
        effect: NoSchedule
      # Allow this pod to be rescheduled while the node is in "critical add-ons only" mode.
      # This, along with the annotation above marks this pod as a critical add-on.
      - key: CriticalAddonsOnly
        operator: Exists
      containers:
      - name: cnx-manager-web
        image: tigera/cnx-manager-web:latest
        imagePullPolicy: Never
        env:
          - name: CNX_WEB_OIDC_CLIENT_ID
            valueFrom:
              configMapKeyRef:
                name: tigera-cnx-manager-web-config
                key: tigera.cnx-web.oidc-client-id
          - name: CNX_WEB_K8S_API
            valueFrom:
              configMapKeyRef:
                name: tigera-cnx-manager-web-config
                key: tigera.cnx-web.kubernetes-api

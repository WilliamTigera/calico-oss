{{- if .Values.networkpolicies.create }}
---
apiVersion: "projectcalico.org/v3"
kind: NetworkPolicy
metadata:
    name: allow-cnx.allow-voltron-access
    namespace: {{ .Values.Namespace }}
spec:
    tier: allow-cnx
    order: 0
    selector: k8s-app == '{{ include "cnx-voltron.name" . }}'
    ingress:
        - action: Allow
          protocol: TCP
          source:
              nets:
                  - 0.0.0.0/0
          destination:
              ports:
                  - '{{ .Values.service.port }}'
                  - '{{ .Values.service.tunnelPort }}'
    types:
        - Ingress
{{- end -}}

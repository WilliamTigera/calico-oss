---                                                                                                                           
layout: null                                                                     
--- 

---
# Required RBAC:
# - get/list workloadenpoints and pods
apiVersion: v1
kind: Namespace
metadata:
  name: tigera-internal
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: tigera-internal
  name: tigera-internal-role
rules:
  - apiGroups: [""]
    resources: [""]
    verbs: [""]
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: tigera-internal-binding
subjects:
  - kind: Group
    name: system:authenticated
    apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: tigera-internal-role
  apiGroup: rbac.authorization.k8s.io
---

# Global Alert for network ssh
apiVersion: projectcalico.org/v3
kind: GlobalAlertTemplate
metadata:
  name: honeypod.network.ssh
spec:
  description: "Alerts on Honeypod accessed via SSH"
  summary: "[Honeypod] Attempted SSH connection by ${source_namespace}/${source_name_aggr}"
  severity: 100
  dataSet: flows
  query: 'dest_namespace="tigera-internal" AND "dest_port"="22" AND reporter="dst"'
  aggregateBy: [source_namespace, source_name_aggr, dest_namespace, dest_name_aggr, host.keyword]
---
apiVersion: projectcalico.org/v3
kind: GlobalAlert
metadata:
  name: honeypod.network.ssh
spec:
  description: "[Honeypod] Attempted SSH connection by ${source_namespace}/${source_name_aggr}"
  severity: 100
  dataSet: flows
  query: 'dest_namespace="tigera-internal" AND "dest_port"="22" AND reporter="dst"'
  aggregateBy: [source_namespace, source_name_aggr, dest_namespace, dest_name_aggr, host.keyword]
---
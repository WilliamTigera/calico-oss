---
title: Securing CNX Manager with TLS
---

Tigera CNX Manager's Web UI, run from your browser, uses HTTPS to securely communicate
with the CNX Manager, which in turn, communicates with the Kubernetes and CNX API
servers also using HTTPS. Through the installation steps, secure communication between
CNX components should already be configured, but secure communication through your web
browser of choice may not. To verify if this is properly configured, the web browser
you are using should display `Secure` in the address bar.

# Components

Before we set up TLS certificates, it is important to understand the traffic
that we are securing. By default, your web browser of choice communicates with
CNX Manager through a
[`NodePort` service](https://kubernetes.io/docs/tutorials/services/source-ip/#source-ip-for-services-with-typenodeport){:target="_blank"}
over port `30003`. The NodePort service passes through packets without modification.
TLS traffic is [terminated](https://en.wikipedia.org/wiki/TLS_termination_proxy){:target="_blank"}
at the CNX Manager. This means that the TLS certificates used to secure traffic
between your web browser and the CNX Manager do not need to be shared or related
to any other TLS certificates that may be used elsewhere in your cluster or when
configuring CNX. The flow of traffic should look like the following:

![CNX Manager traffic diagram]({{site.baseurl}}/images/cnx-tls-mgr-comms.svg)

> **Note** the `NodePort` service in the above diagram can be replaced with other
> [Kubernetes services](https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services---service-types){:target="_blank"}.
> Configuration will vary if another service, such as a load balancer, is placed between the web
> browser and the CNX Manager.
{: .alert .alert-info}

# Configuring TLS

In order to properly configure TLS in the CNX Manager, you will need
certificates and keys signed by an appropriate Certificate Authority (CA).
For more high level information on certificates, keys, and CAs, see
[this blogpost](https://blog.talpor.com/2015/07/ssltls-certificates-beginners-tutorial){:target="_blank"}.

> **Note** It is important when generating your certificates to make sure
> that the Common Name or Subject Alternative Name specified in your certificates
> matches the host name/DNS entry/IP address that is used to access the CNX Manager
> (i.e. what it says in the browser address bar).
{: .alert .alert-info}

Once you have the proper server certificates, you will need to add them to the
CNX Manager. During installation of the CNX Manager, you should have run
the following command.

```
sudo kubectl create secret generic cnx-manager-tls --from-file=cert=/etc/kubernetes/pki/apiserver.crt \
--from-file=key=/etc/kubernetes/pki/apiserver.key -n kube-system
```
> **Note** If you are using certificates not from a third party CA,
> you will need to also add your certificates to your web browser.
> See the `Troubleshooting` section for details.

The `.crt` and `.key` files should be the TLS certificate and key respectively
that you are using for securing the traffic with TLS. If you need to replace the
certificates that you specified during installation, rerunning this command while
specifying the correct files will fix the issue. Once the certificates are updated,
you will need to kill the CNX Manager pod so that it is restarted to uptake the new
certificates.

```
kubectl delete pod <cnx-manager-pod-name> -n kube-system
```

# Troubleshooting
If your web browser still does not display `Secure` in the address bar, the most
common reasons and their fixes are listed below.

## Untrusted Certificate Authority
Your browser may not display `Secure` because it does not know (and therefore trust)
the Certificate Authority (CA) that issued the certificates that the CNX Manager is using.
This is generally caused by using self-signed certificates (either generated by
Kubernetes or manually). If you have certificates signed by a recognized CA, we
recommend that you use them with the CNX Manager since the browser will automatically
recognize them.

If you opt to use self-signed certificates you can still configure your browser to
trust the CA on a per-browser basis by importing the CA certificates into the browser.
In Google Chrome, this can be achieved by selecting Settings, Advanced, Privacy and security,
Manage certificates, Authorities, Import. This is not recommended since it requires the CA
to be imported into every browser you access CNX Manager from.

## Mismatched Common Name or Subject Alternative Name
If you are still having issues securely accessing CNX Manager with TLS, you may
want to make sure that the Common Name or Subject Alternative Name specified
in your certificates matches the host name/DNS entry/IP address that is used
to access the CNX Manager (i.e. what it says in the browser address bar).
In Google Chrome you can check the CNX Manager certificate with Developer Tools
(Ctrl+Shift+I), Security. If you are issued certificates which do not match,
you will need to reissue the certificates with the correct Common Name or 
Subject Alternative Name and reconfigure CNX Manager following the steps above.

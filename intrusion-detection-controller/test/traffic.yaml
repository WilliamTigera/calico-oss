apiVersion: v1
kind: ConfigMap
metadata:
  name: locustfile
data:
  locustfile.py: |
    from locust import HttpLocust, TaskSet, task

    class UserBehavior(TaskSet):

        @task
        def index(self):
            self.client.get("/")

    class WebsiteUser(HttpLocust):
        task_set = UserBehavior
        min_wait = 500
        max_wait = 1500

---

apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: locust
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: locust
    spec:
      containers:
      - name: locust
        image: spikecurtis/locust:latest
        imagePullPolicy: IfNotPresent
        env:
          - name: ATTACKED_HOST
            value: "http://customer/"
          - name: NUM_USERS
            value: "300"
          - name: SPAWN_RATE
            value: "10"
        volumeMounts:
            - name: locustfile
              mountPath: /locust
      volumes:
          - name: locustfile
            configMap:
              name: locustfile

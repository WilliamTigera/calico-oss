# This manifest includes some additional resources required to
# deploy Prometheus Operator with Openshift.
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRole
metadata:
  name: calico-prometheus-operator-finalizers
  namespace: calico-monitoring
rules:
- apiGroups:
  - monitoring.coreos.com
  resources:
  - alertmanagers/finalizers
  - prometheuses/finalizers
  - servicemonitors/finalizers
  verbs:
  - "*"
---

apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: calico-prometheus-operator-finalizers
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: calico-prometheus-operator-finalizers
subjects:
- kind: ServiceAccount
  name: calico-prometheus-operator
  namespace: calico-monitoring

---

apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  name: node-exporter
  namespace: kube-system
  labels:
    k8s-app: calico-node
spec:
  template:
    metadata:
      name: node-exporter
      labels:
        k8s-app: calico-node
    spec:
      serviceAccountName: calico
      containers:
      - image: busybox
        command: ["sleep", "10000000"]
        name: node-exporter
        ports:
        - containerPort: 9081
          hostPort: 9081
          name: scrape
      hostNetwork: true
      hostPID: true
---

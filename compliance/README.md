# Tigera compliance

Components related to the compliance dashboard and reporting feature of TSEE.

Contents
  * config-snapshotter/ - Periodic snapshotter required for configuration replays using audit logs
  * report-generator/ - The job that generates a report
  * report-generator-scheduler/ - The scheduler used for creating single-run report-generator jobs


### Benchmarker

Compliance benchmarker uses [aquasecurity/kube-bench](https://github.com/aquasecurity/kube-bench) to perform 
[CIS benchmarking](https://www.cisecurity.org/benchmark/kubernetes/). The CIS benchmark standards may or may not change 
when a new version of kubernetes is released. So it is upto the developer to check if new CIS benchmarks are introduced,
and if it did, update the kube-bench image as needed. As of now CIS benchmarks are the only benchmarks benchmarker implements. 

#### When and How to update kube-bench

When a new CIS benchmark standard is introduced, and is implemented by kube-bench, we should update the kube-bench version. 
As of this writing kube-bench (`v0.6.5`) implements CIS benchmarks for vanilla kubernetes upto `cis-1.20`, GKE benchmarks 
upto `gke-1.2.0`, OCP upto `rh-1.0` and AKS upto aks-1.0, 
[mapped as listed here](https://github.com/aquasecurity/kube-bench/blob/main/cfg/config.yaml#L242-L256)
When a new standard is introduced for kubernetes, or one of the managed kubernetes we have to update kube-bench version.

To update kube-bench do the following, update the `base` image (`aquasec/kube-bench`) with desired version in 
[Dockerfile](docker-image/benchmarker/Dockerfile.amd64) along with matching `github.com/aquasecurity/kube-bench` in 
[go.mod](go.mod). Ensure that the image passe all the tests and e2es.

### Interface mocking

Most mocks are [testify mocks](https://github.com/stretchr/testify/#mock-package) generated using [mockery](https://github.com/vektra/mockery). 
The mocks generated using mockery can be found in the environment variable MOCKERY_FILE_PATHS, and can be regenerated by running
``make gen-mocks``.
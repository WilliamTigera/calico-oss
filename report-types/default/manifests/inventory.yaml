apiVersion: projectcalico.org/v3
kind: GlobalReportType
metadata:
  creationTimestamp: null
  labels:
    global-report-type: inventory
  name: inventory
spec:
  downloadTemplates:
  - name: summary.csv
    template: |
      startTime,endTime,endpointSelector,namespaceNames,namespaceSelector,serviceAccountNames,serviceAccountSelectors,endpointsNumInScope,endpointsNumIngressProtected,endpointsNumEgressProtected,endpointsNumIngressFromInternet,endpointsNumEgressToInternet,endpointsNumIngressFromOtherNamespace,endpointsNumEgressToOtherNamespace,endpointsNumEnvoyEnabled
      {{ .StartTime }},{{ .EndTime }},{{ .ReportSpec.EndpointsSelection.EndpointSelector }},{{ join .ReportSpec.EndpointsSelection.Namespaces.Names ";" }},{{ .ReportSpec.EndpointsSelection.Namespaces.Selector }},{{ join .ReportSpec.EndpointsSelection.ServiceAccounts.Names ";" }},{{ .ReportSpec.EndpointsSelection.ServiceAccounts.Selector }},{{ {{ .EndpointsSummary.NumTotal }},{{ .EndpointsSummary.NumIngressProtected }},{{.EndpointsSummary.NumEgressProtected }},{{ .EndpointsSummary.NumIngressFromInternet }},{{ .EndpointsSummary.NumEgressToInternet }},{{ .EndpointsSummary.NumIngressFromOtherNamespace }},{{ .EndpointsSummary.NumEgressToOtherNamespace }},{{ .EndpointsSummary.NumEnvoyEnabled }}
  - name: endpoints.csv
    template: |
      endpoint,ingressProtected,egressProtected,envoyEnabled,appliedPolicies,services
      {{ range .Endpoints -}}
      {{ .Endpoint }},{{ .IngressProtected }},{{ .EgressProtected }},{{ .EnvoyEnabled }},{{ join .AppliedPolicies “;” }},{{ join .Services “;” }}
      {{- end }}
  includeEndpointData: true
  uiSummaryTemplate:
    name: ui-summary.json
    template: |
      {
        uiSummary: {
          type: "panel",
          heading: 'Inscope vs Protected',
          widgets: [
            {
              type: "radialbarchart",
              heading: 'Endpoints',
              summary: {
                label: 'Total',
                total: {{ .EndpointsSummary.NumTotal }}
              },
              data: [
                {
                  label: 'Protected ingress',
                  value: {{ .EndpointsSummary.NumIngressProtected }}
                }
              ]
            },
            {
              type: "radialbarchart",
              heading: 'Namespaces',
              summary: {
                label: 'Total',
                total: {{ .NamespacesSummary.NumTotal }}
              },
              data: [
                {
                  label: 'Protected ingress',
                  value: {{ .NamespacesSummary.NumIngressProtected }}
                }
              ]
            },
            {
              type: "radialbarchart",
              heading: 'Service Accounts',
              summary: {
                label: 'Total',
                total: {{ .ServicesSummary.NumTotal }}
              },
              data: [
                {
                  label: 'Protected ingress',
                  value: {{ .ServicesSummary.NumIngressProtected }}
                }
              ]
            },
            {
              type: "radialbarchart",
              heading: 'Endpoints',
              summary: {
                label: 'Total',
                total: {{ .EndpointsSummary.NumTotal }}
              },
              data: [
                {
                  label: 'Protected egress',
                  value: {{ .EndpointsSummary.NumEgressProtected }}
                }
              ]
            },
            {
              type: "radialbarchart",
              heading: 'Namespaces',
              summary: {
                label: 'Total',
                total: {{ .NamespacesSummary.NumTotal }}
              },
              data: [
                {
                  label: 'Protected egress',
                  value: {{ .NamespacesSummary.NumEgressProtected }}
                }
              ]
            },
            {
              type: "radialbarchart",
              heading: 'Service Accounts',
              summary: {
                label: 'Total',
                total: {{ .ServicesSummary.NumTotal }}
              },
              data: [
                {
                  label: 'Protected egress',
                  value: {{ .ServicesSummary.NumEgressProtected }}
                }
              ]
            }
          ]
        }
      }
